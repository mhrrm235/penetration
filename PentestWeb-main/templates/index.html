<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Security Check</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 to-white min-h-screen">
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-8 text-blue-900 tracking-wide">ðŸ”’ Website Security & Port Check</h1>

    
    <form method="POST" action="/" class="shadow-lg p-6 mb-8 bg-white rounded-xl max-w-xl mx-auto" enctype="multipart/form-data">
        <div class="mb-4">
            <label for="url" class="block font-semibold mb-2 text-blue-800">Enter Website URL:</label>
            <input type="text" class="form-input w-full border border-blue-200 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" id="url" name="url" placeholder="https://example.com">
        </div>
        <div class="mb-4 flex flex-wrap gap-4">
            <label class="inline-flex items-center">
                <input type="checkbox" name="scan_headers" value="1" class="form-checkbox text-blue-600" checked>
                <span class="ml-2 text-blue-800">Security Headers</span>
            </label>
            <label class="inline-flex items-center">
                <input type="checkbox" name="scan_ssl" value="1" class="form-checkbox text-blue-600" checked>
                <span class="ml-2 text-blue-800">SSL Certificate</span>
            </label>
            <label class="inline-flex items-center">
                <input type="checkbox" name="scan_ports" value="1" class="form-checkbox text-blue-600" checked>
                <span class="ml-2 text-blue-800">Port Scan</span>
            </label>
            <label class="inline-flex items-center">
                <input type="checkbox" name="scan_sqli" value="1" class="form-checkbox text-blue-600" checked>
                <span class="ml-2 text-blue-800">SQL Injection</span>
            </label>
            <label class="inline-flex items-center">
                <input type="checkbox" name="scan_xss" value="1" class="form-checkbox text-blue-600" checked>
                <span class="ml-2 text-blue-800">XSS</span>
            </label>
            <label class="inline-flex items-center">
                <input type="checkbox" name="scan_lfi" value="1" class="form-checkbox text-blue-600" checked>
                <span class="ml-2 text-blue-800">LFI</span>
            </label>
            <label class="inline-flex items-center">
                <input type="checkbox" name="scan_dirtrav" value="1" class="form-checkbox text-blue-600" checked>
                <span class="ml-2 text-blue-800">Directory Traversal</span>
            </label>
            <label class="inline-flex items-center">
                <input type="checkbox" name="scan_openredir" value="1" class="form-checkbox text-blue-600" checked>
                <span class="ml-2 text-blue-800">Open Redirect</span>
            </label>
        </div>

        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition mb-4">Check Security</button>
    </form>

    {% if url %}
        <div class="bg-white shadow-xl rounded-2xl p-8 mb-8">
            <h2 class="mb-6 text-2xl font-bold text-blue-700 border-b-2 border-blue-100 pb-2 text-center">Results for: <span class="text-blue-900">{{ url }}</span></h2>

            {% if latest_summary %}
        <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg shadow">
            <h3 class="text-xl font-bold text-blue-800 mb-2">Ringkasan Scan Terbaru</h3>
            <ul class="mb-2">
                <li><span class="font-bold">Overall Risk Level:</span> {{ latest_summary.overall_risk }}</li>
                <li><span class="font-bold">Risk Ratings:</span>
                    <ul class="list-disc ml-6">
                    {% for rating in latest_summary.risk_ratings %}
                        <li>{{ rating }}</li>
                    {% endfor %}
                    </ul>
                </li>
                <li><span class="font-bold">Scan Information:</span> {{ latest_summary.scan_info }}</li>
            </ul>
        </div>
        {% endif %}

            {% if summary %}
                <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg shadow">
                    <div class="flex flex-wrap justify-between items-start mb-4">
                        <div class="mb-4 md:mb-0">
                            <div class="text-blue-800 font-bold text-lg mb-1">Overall risk level:</div>
                            <div>
                                {% if overall_risk == 'Critical' %}
                                    <span class="bg-red-700 text-white px-6 py-2 rounded font-bold text-lg">Critical</span>
                                {% elif overall_risk == 'High' %}
                                    <span class="bg-red-500 text-white px-6 py-2 rounded font-bold text-lg">High</span>
                                {% elif overall_risk == 'Medium' %}
                                    <span class="bg-yellow-400 text-gray-900 px-6 py-2 rounded font-bold text-lg">Medium</span>
                                {% elif overall_risk == 'Low' %}
                                    <span class="bg-blue-500 text-white px-6 py-2 rounded font-bold text-lg">Low</span>
                                {% else %}
                                    <span class="bg-green-500 text-white px-6 py-2 rounded font-bold text-lg">Info</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="mb-4 md:mb-0">
                            <div class="text-blue-800 font-bold text-lg mb-1">Risk ratings:</div>
                            <div class="flex flex-col gap-1">
                                <div><span class="inline-block w-20">Critical:</span> <span class="bg-red-700 text-white px-2 py-1 rounded">{{ risk_counts['Critical'] }}</span></div>
                                <div><span class="inline-block w-20">High:</span> <span class="bg-red-500 text-white px-2 py-1 rounded">{{ risk_counts['High'] }}</span></div>
                                <div><span class="inline-block w-20">Medium:</span> <span class="bg-yellow-400 text-gray-900 px-2 py-1 rounded">{{ risk_counts['Medium'] }}</span></div>
                                <div><span class="inline-block w-20">Low:</span> <span class="bg-blue-500 text-white px-2 py-1 rounded">{{ risk_counts['Low'] }}</span></div>
                                <div><span class="inline-block w-20">Info:</span> <span class="bg-green-500 text-white px-2 py-1 rounded">{{ risk_counts['Info'] }}</span></div>
                            </div>
                        </div>
                        <div>
                            <div class="text-blue-800 font-bold text-lg mb-1">Scan information:</div>
                            <div class="text-sm">
                                <div>Start time: {{ scan_info.start_time }}</div>
                                <div>Finish time: {{ scan_info.finish_time }}</div>
                                <div>Tests performed: {{ scan_info.tests_performed }}</div>
                                <div>Scan status: <span class="bg-green-600 text-white px-2 py-1 rounded">{{ scan_info.status }}</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="font-bold text-blue-800 mb-2">Risk Level per Test:</div>
                        <ul class="list-disc ml-6">
                            {% for test, level in risk_levels %}
                                <li><span class="font-semibold">{{ test }}:</span> {{ level }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <form method="post" action="/export-pdf" target="_blank" class="mb-8 text-center">
                    <input type="hidden" name="url" value="{{ url }}">
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow transition">Export PDF</button>
                </form>
            {% endif %}

            {% if advanced_suggestions %}
                <div class="mb-6 p-4 bg-yellow-50 border border-yellow-300 rounded-lg shadow">
                    <div class="font-bold text-yellow-800 mb-2 text-lg">Saran Perbaikan Lanjutan:</div>
                    <ul class="list-disc ml-6 text-yellow-900">
                        {% for saran in advanced_suggestions %}
                            <li>{{ saran }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            {% if headers %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-6">Security Headers</div>
                <ul class="divide-y divide-blue-100 mb-6">
                    {% for header, value, valid in headers %}
                        <li class="flex justify-between items-center py-2 px-3 bg-blue-50 rounded mb-2">
                            <span class="font-medium">{{ header }}:</span>
                            {% if valid %}
                                <span class="bg-green-500 text-white px-3 py-1 rounded">{{ value }}</span>
                            {% else %}
                                <span class="bg-red-500 text-white px-3 py-1 rounded">Missing</span>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if server_software %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-6">Server Software and Technology Found</div>
                <ul class="divide-y divide-blue-100 mb-6">
                    {% for tech in server_software %}
                        <li class="py-2 px-3 flex items-center gap-2">
                            {% if 'nginx' in tech|lower %}
                                <span title="nginx"><svg class="inline w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#009639"/><text x="12" y="17" text-anchor="middle" font-size="13" fill="white" font-family="Arial">N</text></svg></span>
                            {% elif 'apache' in tech|lower %}
                                <span title="Apache"><svg class="inline w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5" fill="#E95420"/><text x="12" y="17" text-anchor="middle" font-size="13" fill="white" font-family="Arial">A</text></svg></span>
                            {% elif 'iis' in tech|lower %}
                                <span title="IIS"><svg class="inline w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5" fill="#0078D6"/><text x="12" y="17" text-anchor="middle" font-size="13" fill="white" font-family="Arial">I</text></svg></span>
                            {% elif 'cloudflare' in tech|lower %}
                                <span title="Cloudflare"><svg class="inline w-5 h-5 text-orange-400" fill="currentColor" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="10" ry="7" fill="#F38020"/></svg></span>
                            {% elif 'php' in tech|lower %}
                                <span title="PHP"><svg class="inline w-5 h-5 text-indigo-600" fill="currentColor" viewBox="0 0 24 24"><ellipse cx="12" cy="12" rx="10" ry="7" fill="#777BB4"/><text x="12" y="17" text-anchor="middle" font-size="13" fill="white" font-family="Arial">P</text></svg></span>
                            {% elif 'python' in tech|lower %}
                                <span title="Python"><svg class="inline w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="#FFD43B"/><text x="12" y="17" text-anchor="middle" font-size="13" fill="#306998" font-family="Arial">Py</text></svg></span>
                            {% elif 'node' in tech|lower %}
                                <span title="Node.js"><svg class="inline w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 24 24"><polygon points="12,2 22,7 22,17 12,22 2,17 2,7" fill="#43853D"/><text x="12" y="17" text-anchor="middle" font-size="13" fill="white" font-family="Arial">N</text></svg></span>
                            {% endif %}
                            {{ tech }}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if ssl %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-6">SSL Certificate</div>
                <ul class="divide-y divide-blue-100 mb-6">
                    <li class="py-2 px-3"><b>Subject:</b> {{ ssl.subject }}</li>
                    <li class="py-2 px-3"><b>Issuer:</b> {{ ssl.issuer }}</li>
                    <li class="py-2 px-3"><b>Valid From:</b> {{ ssl.valid_from }}</li>
                    <li class="py-2 px-3"><b>Valid To:</b> {{ ssl.valid_to }}</li>
                    <li class="py-2 px-3"><b>Validity:</b> {% if ssl.is_valid %}<span class="bg-green-500 text-white px-3 py-1 rounded">Valid</span>{% else %}<span class="bg-red-500 text-white px-3 py-1 rounded">Expired</span>{% endif %}</li>
                </ul>
            {% endif %}

            {% if ports %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-6">Port Scan</div>
                {% if ports.error %}
                    <div class="bg-red-100 text-red-700 rounded px-4 py-2 mb-4">{{ ports.error }}</div>
                    <div class="bg-yellow-100 text-yellow-800 rounded px-4 py-2 mb-4">
                        <b>Saran:</b> Pastikan server dapat diakses dan tidak memblokir port scan dari luar.<br>
                        <b>Tips Lanjutan:</b> Gunakan <b>firewall</b> berbasis whitelist, aktifkan <b>port knocking</b> untuk port sensitif, dan monitoring akses port secara real-time.
                    </div>
                {% else %}
                    <ul class="divide-y divide-blue-100 mb-6">
                        {% for proto, port_list in ports.items() %}
                            <li class="py-2 px-3"><b>{{ proto|capitalize }} Ports:</b> <span class="bg-blue-200 text-blue-900 px-3 py-1 rounded">{{ port_list|join(', ') }}</span></li>
                        {% endfor %}
                    </ul>
                {% endif %}
            {% endif %}

            {% if sqlinj %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-8">SQL Injection Test Results</div>
                <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-blue-200 rounded-lg">
                    <thead class="bg-blue-100">
                        <tr>
                            <th class="py-2 px-4 text-left">Payload</th>
                            <th class="py-2 px-4 text-left">Vulnerable?</th>
                            <th class="py-2 px-4 text-left">Detail/Error</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for payload, is_vuln, detail in sqlinj %}
                        <tr class="border-t border-blue-100">
                            <td class="py-2 px-4 font-mono">{{ payload }}</td>
                            <td class="py-2 px-4">{% if is_vuln %}<span class="bg-red-500 text-white px-3 py-1 rounded">YES</span>{% else %}<span class="bg-green-500 text-white px-3 py-1 rounded">NO</span>{% endif %}</td>
                            <td class="py-2 px-4">{{ detail if detail else '-' }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                </div>
                <div class="mb-4">
                    <h3 class="font-bold text-blue-800 mb-2">SQL Injection Result:</h3>
                    <ul>
                        {% for url, vuln, detail in sqlinj %}
                        <li class="mb-1">
                            <span class="font-semibold">{{ url }}</span>:
                            {% if vuln %}
                                <span class="text-red-600 font-bold">VULNERABLE</span>
                            {% else %}
                                <span class="text-green-700 font-bold">Not Vulnerable</span>
                            {% endif %}
                            <span class="ml-2 text-gray-600">{{ detail }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                    <button id="btn-sqlmap-detail" class="mt-3 bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-4 rounded" onclick="loadSqlmapDetail()">Lihat Detail SQLmap</button>
                    <div id="sqlmap-detail-result" class="mt-4 text-sm bg-gray-50 border border-gray-200 rounded p-3 hidden"></div>
                </div>
                <script>
                function loadSqlmapDetail() {
                    const btn = document.getElementById('btn-sqlmap-detail');
                    const resultDiv = document.getElementById('sqlmap-detail-result');
                    btn.disabled = true;
                    btn.textContent = 'Loading...';
                    fetch(`/sqlmap-detail?url={{ url|urlencode }}`)
                        .then(r => r.json())
                        .then(data => {
                            btn.disabled = false;
                            btn.textContent = 'Lihat Detail SQLmap';
                            if (data.error) {
                                resultDiv.innerHTML = '<span class="text-red-600">' + data.error + '</span>';
                            } else {
                                let html = '';
                                for (const [table, tbl] of Object.entries(data)) {
                                    html += `<div class='mb-2'><b>Table: ${table}</b><table class='border mt-1 mb-2 w-full text-xs'><thead><tr>`;
                                    for (const col of tbl.columns) html += `<th class='border px-1'>${col}</th>`;
                                    html += '</tr></thead><tbody>';
                                    for (const row of tbl.rows) {
                                        html += '<tr>';
                                        for (const cell of row) html += `<td class='border px-1'>${cell}</td>`;
                                        html += '</tr>';
                                    }
                                    html += '</tbody></table></div>';
                                }
                                resultDiv.innerHTML = html || '<i>No data found in session.sqlite.</i>';
                            }
                            resultDiv.classList.remove('hidden');
                        })
                        .catch(e => {
                            btn.disabled = false;
                            btn.textContent = 'Lihat Detail SQLmap';
                            resultDiv.innerHTML = '<span class="text-red-600">Gagal mengambil data.</span>';
                            resultDiv.classList.remove('hidden');
                        });
                }
                </script>
            {% endif %}

            {% if xss %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-8">XSS Test Results</div>
                <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-blue-200 rounded-lg">
                    <thead class="bg-blue-100">
                        <tr>
                            <th class="py-2 px-4 text-left">Payload</th>
                            <th class="py-2 px-4 text-left">Reflected?</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for payload, found in xss %}
                        <tr class="border-t border-blue-100">
                            <td class="py-2 px-4 font-mono">{{ payload }}</td>
                            <td class="py-2 px-4">{% if found %}<span class="bg-red-500 text-white px-3 py-1 rounded">YES</span>{% else %}<span class="bg-green-500 text-white px-3 py-1 rounded">NO</span>{% endif %}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                </div>
            {% endif %}

            {% if lfi %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-8">LFI Test Results</div>
                <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-blue-200 rounded-lg">
                    <thead class="bg-blue-100">
                        <tr>
                            <th class="py-2 px-4 text-left">Payload</th>
                            <th class="py-2 px-4 text-left">Vulnerable?</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for payload, found in lfi %}
                        <tr class="border-t border-blue-100">
                            <td class="py-2 px-4 font-mono">{{ payload }}</td>
                            <td class="py-2 px-4">{% if found %}<span class="bg-red-500 text-white px-3 py-1 rounded">YES</span>{% else %}<span class="bg-green-500 text-white px-3 py-1 rounded">NO</span>{% endif %}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                </div>
            {% endif %}

            {% if dirtrav %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-8">Directory Traversal Test Results</div>
                <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-blue-200 rounded-lg">
                    <thead class="bg-blue-100">
                        <tr>
                            <th class="py-2 px-4 text-left">Payload</th>
                            <th class="py-2 px-4 text-left">Vulnerable?</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for payload, found in dirtrav %}
                        <tr class="border-t border-blue-100">
                            <td class="py-2 px-4 font-mono">{{ payload }}</td>
                            <td class="py-2 px-4">{% if found %}<span class="bg-red-500 text-white px-3 py-1 rounded">YES</span>{% else %}<span class="bg-green-500 text-white px-3 py-1 rounded">NO</span>{% endif %}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                </div>
            {% endif %}

            {% if openredir %}
                <div class="text-lg font-semibold text-blue-800 mb-2 mt-8">Open Redirect Test Results</div>
                <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-blue-200 rounded-lg">
                    <thead class="bg-blue-100">
                        <tr>
                            <th class="py-2 px-4 text-left">Payload</th>
                            <th class="py-2 px-4 text-left">Vulnerable?</th>
                            <th class="py-2 px-4 text-left">Redirect Location</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for payload, found, location in openredir %}
                        <tr class="border-t border-blue-100">
                            <td class="py-2 px-4 font-mono">{{ payload }}</td>
                            <td class="py-2 px-4">{% if found %}<span class="bg-red-500 text-white px-3 py-1 rounded">YES</span>{% else %}<span class="bg-green-500 text-white px-3 py-1 rounded">NO</span>{% endif %}</td>
                            <td class="py-2 px-4 font-mono">{{ location }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if multi_results %}
        <div class="bg-white shadow-xl rounded-2xl p-8 mb-8">
            <h2 class="mb-6 text-2xl font-bold text-blue-700 border-b-2 border-blue-100 pb-2 text-center">Multi-Scan Results</h2>
            <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-blue-200 rounded-lg">
                <thead class="bg-blue-100">
                    <tr>
                        <th class="py-2 px-4">URL</th>
                        <th class="py-2 px-4">Skor</th>
                        <th class="py-2 px-4">Kategori</th>
                        <th class="py-2 px-4">Headers</th>
                        <th class="py-2 px-4">SSL</th>
                        <th class="py-2 px-4">Ports</th>
                        <th class="py-2 px-4">SQLi</th>
                    </tr>
                </thead>
                <tbody>
                {% for row in multi_results %}
                    <tr class="border-t border-blue-100">
                        <td class="py-2 px-4 font-mono">{{ row.url }}</td>
                        <td class="py-2 px-4">{{ row.skor }}</td>
                        <td class="py-2 px-4">{{ row.kategori }}</td>
                        <td class="py-2 px-4">{{ row.nilai_headers }}</td>
                        <td class="py-2 px-4">{{ row.nilai_ssl }}</td>
                        <td class="py-2 px-4">{{ row.nilai_ports }}</td>
                        <td class="py-2 px-4">{{ row.nilai_sqlinj }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
    {% endif %}
</div>
</body>
</html>
