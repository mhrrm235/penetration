<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Security Report</title>
    <style>
        @page {
            margin: 1cm;
            size: A4;
            @top-right {
                content: "Page " counter(page) " of " counter(pages);
                font-size: 10pt;
            }
        }
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: white;
        }
        .cover {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        .logo {
            width: 100px;
            height: 100px;
            margin-bottom: 30px;
        }
        .report-title {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        .report-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 40px;
        }
        .report-meta {
            font-size: 14px;
            color: #666;
        }
        .content {
            padding: 40px;
        }
        .section {
            margin-bottom: 30px;
            break-inside: avoid;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
        }
        .summary-box {
            background: #eaf6fb;
            border: 1px solid #b5d6ea;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .qr-section {
            text-align: center;
            margin: 40px 0;
        }
        .status-safe { color: #27ae60; }
        .status-warning { color: #f1c40f; }
        .status-danger { color: #c0392b; }
    </style>
</head>
<body>
<!-- Cover Page -->
<div class="cover">
    <div class="logo">ðŸ”’</div>
    <h1 class="report-title">Website Security Assessment Report</h1>
    <div class="report-subtitle">Detailed Security Analysis for: {{ url }}</div>
    <div class="report-meta">
        Report Generated: {{ scan_time }}
    </div>
</div>

<!-- Main Content -->
<div style="page-break-before: always;" class="content">
    <h1 style="text-align:center; color:#2c3e50; margin-bottom: 30px;">ðŸ”’ Website Security & Port Check Report</h1>
    <h2 style="color:#2980b9;">Results for: <span style="font-weight:bold;">{{ url }}</span></h2>

    {% if summary %}
        <div style="background:#e0e7ff; border-radius:8px; padding:18px; margin-bottom:30px;">
            <h3 style="color:#1e293b; font-size:1.2em; font-weight:bold; margin-bottom:10px;">Summary</h3>
            <ul style="margin:0 0 0 18px; color:#222;">
                <li><span style="font-weight:bold;">Overall Risk Level:</span> {{ overall_risk }}</li>
                <li><span style="font-weight:bold;">Risk Ratings:</span>
                    <ul style="margin-left:18px;">
                        <li>Critical: <span style="color:#c0392b; font-weight:bold;">{{ risk_counts['Critical'] }}</span></li>
                        <li>High: <span style="color:#e74c3c; font-weight:bold;">{{ risk_counts['High'] }}</span></li>
                        <li>Medium: <span style="color:#f1c40f; font-weight:bold;">{{ risk_counts['Medium'] }}</span></li>
                        <li>Low: <span style="color:#2980b9; font-weight:bold;">{{ risk_counts['Low'] }}</span></li>
                        <li>Info: <span style="color:#27ae60; font-weight:bold;">{{ risk_counts['Info'] }}</span></li>
                    </ul>
                </li>
                <li><span style="font-weight:bold;">Risk Levels:</span>
                    <ul style="margin-left:18px;">
                        {% for test, level in risk_levels %}
                        <li>{{ test }}: <span style="font-weight:bold;">{{ level }}</span></li>
                        {% endfor %}
                    </ul>
                </li>
                <li><span style="font-weight:bold;">Scan Information:</span>
                    <ul style="margin-left:18px;">
                        <li>Start time: {{ scan_info.start_time }}</li>
                        <li>Finish time: {{ scan_info.finish_time }}</li>
                        <li>Tests performed: {{ scan_info.tests_performed }}</li>
                        <li>Status: {{ scan_info.status }}</li>
                    </ul>
                </li>
                <li><span style="font-weight:bold;">Server Info:</span> {{ server_info }}</li>
            </ul>
        </div>
    {% endif %}

    {% if headers %}
        <h3 style="margin-top:30px; color:#34495e;">Security Headers</h3>
        <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
            <tr style="background:#e9ecef;">
                <th style="padding:8px; border:1px solid #ccc;">Header</th>
                <th style="padding:8px; border:1px solid #ccc;">Status</th>
            </tr>
            {% for header, value, valid in headers %}
            <tr>
                <td style="padding:8px; border:1px solid #ccc;">{{ header }}</td>
                <td style="padding:8px; border:1px solid #ccc;">
                    {% if valid %}
                        <span style="color: #27ae60; font-weight:bold;">{{ value }}</span>
                    {% else %}
                        <span style="color: #c0392b; font-weight:bold;">Missing</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    {% endif %}

    {% if server_software %}
        <h3 style="margin-top:30px; color:#34495e;">Server Software and Technology Found</h3>
        <ul style="margin-bottom:20px;">
            {% for tech in server_software %}
                <li style="padding:6px 0;">{{ tech }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if ssl %}
        <h3 style="margin-top:30px; color:#34495e;">SSL Certificate</h3>
        <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
            <tr><td style="padding:8px; border:1px solid #ccc; width:200px;">Subject</td><td style="padding:8px; border:1px solid #ccc;">{{ ssl.subject }}</td></tr>
            <tr><td style="padding:8px; border:1px solid #ccc;">Issuer</td><td style="padding:8px; border:1px solid #ccc;">{{ ssl.issuer }}</td></tr>
            <tr><td style="padding:8px; border:1px solid #ccc;">Valid From</td><td style="padding:8px; border:1px solid #ccc;">{{ ssl.valid_from }}</td></tr>
            <tr><td style="padding:8px; border:1px solid #ccc;">Valid To</td><td style="padding:8px; border:1px solid #ccc;">{{ ssl.valid_to }}</td></tr>
            <tr><td style="padding:8px; border:1px solid #ccc;">Validity</td><td style="padding:8px; border:1px solid #ccc;">
                {% if ssl.is_valid %}
                    <span style="color: #27ae60; font-weight:bold;">Valid</span>
                {% else %}
                    <span style="color: #c0392b; font-weight:bold;">Expired</span>
                {% endif %}
            </td></tr>
        </table>
    {% endif %}

    {% if ports %}
        <h3 style="margin-top:30px; color:#34495e;">Port Scan</h3>
        {% if ports.error %}
            <div style="color:#c0392b; font-weight:bold; margin-bottom:10px;">{{ ports.error }}</div>
        {% else %}
            {% for proto, port_list in ports.items() %}
                <h4>{{ proto|capitalize }}</h4>
                <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
                    <tr style="background:#e9ecef;">
                        <th style="padding:8px; border:1px solid #ccc;">Port</th>
                        <th style="padding:8px; border:1px solid #ccc;">State</th>
                        <th style="padding:8px; border:1px solid #ccc;">Service</th>
                        <th style="padding:8px; border:1px solid #ccc;">Product</th>
                        <th style="padding:8px; border:1px solid #ccc;">Version</th>
                    </tr>
                    {% for portinfo in port_list %}
                    <tr>
                        <td style="padding:8px; border:1px solid #ccc;">{{ portinfo.port }}</td>
                        <td style="padding:8px; border:1px solid #ccc;">{{ portinfo.state }}</td>
                        <td style="padding:8px; border:1px solid #ccc;">{{ portinfo.service }}</td>
                        <td style="padding:8px; border:1px solid #ccc;">{{ portinfo.product }}</td>
                        <td style="padding:8px; border:1px solid #ccc;">{{ portinfo.version }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% endfor %}
        {% endif %}
    {% endif %}

    {% if sqlinj %}
        <h3 style="margin-top:30px; color:#34495e;">SQL Injection Test Results</h3>
        <table style="width:100%; border-collapse:collapse;">
            <tr style="background:#e9ecef;">
                <th style="padding:8px; border:1px solid #ccc;">Payload</th>
                <th style="padding:8px; border:1px solid #ccc;">Vulnerable?</th>
                <th style="padding:8px; border:1px solid #ccc;">Detail/Error</th>
            </tr>
            {% for payload, is_vuln, detail in sqlinj %}
            <tr>
                <td style="padding:8px; border:1px solid #ccc;"><code>{{ payload }}</code></td>
                <td style="padding:8px; border:1px solid #ccc;">
                    {% if is_vuln %}
                        <span style="color: #c0392b; font-weight:bold;">YES</span>
                    {% else %}
                        <span style="color: #27ae60; font-weight:bold;">NO</span>
                    {% endif %}
                </td>
                <td style="padding:8px; border:1px solid #ccc;">{{ detail if detail else '-' }}</td>
            </tr>
            {% endfor %}
        </table>
    {% endif %}

    {% if xss %}
        <h3 style="margin-top:30px; color:#34495e;">XSS Test Results</h3>
        <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
            <thead style="background:#e0e7ff;">
                <tr>
                    <th style="padding:8px 12px; text-align:left;">Payload</th>
                    <th style="padding:8px 12px; text-align:left;">Reflected?</th>
                </tr>
            </thead>
            <tbody>
            {% for payload, found in xss %}
                <tr>
                    <td style="padding:8px 12px; font-family:monospace;">{{ payload }}</td>
                    <td style="padding:8px 12px;">{% if found %}<span style="background:#ef4444; color:white; padding:2px 12px; border-radius:6px;">YES</span>{% else %}<span style="background:#22c55e; color:white; padding:2px 12px; border-radius:6px;">NO</span>{% endif %}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}

    {% if lfi %}
        <h3 style="margin-top:30px; color:#34495e;">LFI Test Results</h3>
        <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
            <thead style="background:#e0e7ff;">
                <tr>
                    <th style="padding:8px 12px; text-align:left;">Payload</th>
                    <th style="padding:8px 12px; text-align:left;">Vulnerable?</th>
                </tr>
            </thead>
            <tbody>
            {% for payload, found in lfi %}
                <tr>
                    <td style="padding:8px 12px; font-family:monospace;">{{ payload }}</td>
                    <td style="padding:8px 12px;">{% if found %}<span style="background:#ef4444; color:white; padding:2px 12px; border-radius:6px;">YES</span>{% else %}<span style="background:#22c55e; color:white; padding:2px 12px; border-radius:6px;">NO</span>{% endif %}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% endif %}

    {% if sqli_deep %}
        <h3 style="margin-top:30px; color:#34495e;">SQLi Deep Test Results</h3>
        <table style="width:100%; border-collapse:collapse;">
            <tr style="background:#e9ecef;">
                <th style="padding:8px; border:1px solid #ccc;">Method/Param</th>
                <th style="padding:8px; border:1px solid #ccc;">Payload</th>
                <th style="padding:8px; border:1px solid #ccc;">Vulnerable?</th>
                <th style="padding:8px; border:1px solid #ccc;">Detail/Error</th>
            </tr>
            {% for method, payload, vuln, detail in sqli_deep %}
            <tr>
                <td style="padding:8px; border:1px solid #ccc;">{{ method }}</td>
                <td style="padding:8px; border:1px solid #ccc;"><code>{{ payload }}</code></td>
                <td style="padding:8px; border:1px solid #ccc;">
                    {% if vuln %}
                        <span style="color: #c0392b; font-weight:bold;">YES</span>
                    {% else %}
                        <span style="color: #27ae60; font-weight:bold;">NO</span>
                    {% endif %}
                </td>
                <td style="padding:8px; border:1px solid #ccc;">{{ detail if detail else '-' }}</td>
            </tr>
            {% endfor %}
        </table>
    {% endif %}
</div>
</body>
</html>
